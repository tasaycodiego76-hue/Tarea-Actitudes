<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crear persona</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" 
  rel="stylesheet" 
  integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" 
  crossorigin="anonymous">

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" 
  integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" 
  crossorigin="anonymous"></script>
</head>
<body>
  <main class="container mt-3">
    <div class="row">
      <div class="col-md-12">
        <h4>Registro de Personas</h4>
        <a href="http://localhost:3000/personas">Mostrar la Lista</a>
      </div>
    </div>

    <div class="row mt-3">
      <div class="col-md-12">
        <form action="" id="formulario-registro" enctype="multipart/form-data" autocomplete="off">
          <div class="card">
            <div class="card-header">
              <strong>Completa el Formulario</strong>
            </div>

            <div class="card-body">
              <div class="row g-2">
                <div class="col-md-6 mb-2">
                  <div class="form-floating">
                    <input 
                      type="text" 
                      class="form-control rounded-0"
                      placeholder="Nombres"
                      id="nombres" 
                      required>
                    <label for="nombres">Nombres</label>
                  </div>
                </div>

                <div class="col-md-6 mb-2">
                  <div class="form-floating">
                    <input 
                      type="text" 
                      class="form-control rounded-0" 
                      placeholder="Apellidos" 
                      id="apellidos" 
                      required>
                    <label for="apellidos">Apellidos</label>
                  </div>
                </div>
              </div>

              <div class="row g-2">
                <div class="col-md-6 mb-2">
                  <div class="form-floating">
                    <input 
                      type="text" 
                      class="form-control rounded-0"
                      placeholder="DNI"
                      id="dni"
                      pattern="[0-9]{8}"
                      title="Solo se permiten 8 números"
                      minlength="8"
                      maxlength="8"
                      required>
                    <label for="dni">DNI</label>
                  </div>
                </div>

                <div class="col-md-6 mb-2">
                  <div class="form-floating">
                    <input 
                      type="text" 
                      class="form-control rounded-0" 
                      placeholder="Teléfono" 
                      id="telefono" 
                      required>
                    <label for="telefono">Teléfono</label>
                  </div>
                </div>
              </div>

              <div class="row g-2">
                <div class="col-md-12">
                  <div class="form-floating">
                    <input 
                      type="file" 
                      id="fotografia" 
                      name="fotografia" 
                      class="form-control rounded-0"
                      accept="image/png, image/jpeg" />
                  </div>
                </div>
              </div>
            </div>

            <div class="card-footer text-end">
              <button type="reset" class="btn btn-sm btn-outline-secondary rounded-0">Cancelar</button>
              <button type="submit" class="btn btn-sm btn-primary rounded-0">Guardar</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
    
      const API_URL = 'http://localhost:3000/api/personas';

      const formulario = document.getElementById('formulario-registro');
      const apellidos = document.getElementById("apellidos");
      const nombres = document.getElementById("nombres");
      const dni = document.getElementById("dni");
      const telefono = document.getElementById("telefono");

      //Esta función permite guardar datos del formulario SIN ADJUNTAR BINARIOS
      async function guardarDatos(){
        const data = {
          apellidos: apellidos.value,
          nombres: nombres.value,
          dni: dni.value,
          telefono: telefono.value,
          fotografia: "foto.jpg"
        };
        
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify(data)
        });

        const result = await response.json();
        console.log(result);
      }

      async function guardarDatosBinario(){
        const formData = new FormData();

        formData.append('apellidos', apellidos.value);
        formData.append('nombres', nombres.value);
        formData.append('dni', dni.value);
        formData.append('telefono', telefono.value);
        formData.append('fotografia', document.querySelector("#fotografia").files[0]);
      
        const response = await fetch(API_URL,{
          method: 'POST',
          body: formData
        });

        const result = await response.json();
        console.log(result);
      }
    
      formulario.addEventListener("submit", (event) =>{
        event.preventDefault(); //Cancelacion de evento

        Swal.fire({
          text: "Registro de personas",
          title: "¿Seguro de guardar?",
          icon: "question",
          confirmButtonText: "Aceptar",
          showCancelButton: true,
          cancelButtonText: "Cancelar"
        }).then((result) => {
          if (result.isConfirmed){
            console.log("Guardando datos...");
            guardarDatosBinario(); 
          }
        });
      });
    });
  </script>
</body>
</html>