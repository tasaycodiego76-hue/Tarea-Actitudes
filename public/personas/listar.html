<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lista de personas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</head>
<body>

  <main class="container ">
    <div class="row">
      <div class="col-md-12">
        <h3>Lista de personas</h3>
        <a href="http://localhost:3000/personas/crear">Registrar</a>
      </div>  
      </div>

      <style>
        td:nth-child(6),
        td:nth-child(7){
          text-align: center;
        }
      </style>

      <div class="row mt-2">
        <div class="col-md-12">
          <div class="table-reponsive">
            <table id="tabla-personas" class="table table-striped table-bordered table-sm">
              <colgroup>
                <col style="width: 5%;">
                <col style="width: 25%;">
                <col style="width: 25%;">
                <col style="width: 10%;">
                <col style="width: 10%;">
                <col style="width: 10%;">
                <col style="width: 15%;">
              </colgroup>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Apellidos</th>
                  <th>Nombre</th>
                  <th>DNI</th>
                  <th>Teléfono</th>
                  <th class="text-center">Fotografia</th>
                  <th class="text-center">Acciones</th>
                </tr>
              </thead>

              <tbody>

              </tbody>
            </table>
          </div>
        </div>
      </div>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11">

    
  </script>

  <script>
    const API_URL = 'http://localhost:3000/api/personas'
    const datosTabla = document.querySelector("#tabla-personas tbody")

    async function obtenerDatos(){
      const response = await fetch(API_URL, {method: 'get'})
      //Console.log(response)

      if(!response.ok){
        console.error("Problemas en la conexion")
        return;
      }
      
      const personas = await response.json()

      if (personas.length == 0){
        console.log("No hay personas registradas")

        const fila = document.createElement("tr")
        const celda = document.createElement ("td")

        celda.colSpan = 7
        celda.textContent = 'No hay personas registradas'
        celda.classList.add('text-center')

        fila.appendChild(celda)
        datosTabla.appendChild(fila)

        return;
      }
      //Renderizar los datos en el cuerpo de la tabla
      console.log(personas)
      personas.forEach(persona => {
        const row = datosTabla.insertRow() //<tr></tr>

        row.insertCell().textContent = persona.id
        row.insertCell().textContent = persona.apellidos
        row.insertCell().textContent = persona.nombres
        row.insertCell().textContent = persona.dni
        row.insertCell().textContent = persona.telefono

        //El campo foto se gestionara a través de un enlace
        const fotoCell = row.insertCell()
        const fotoLnk = document.createElement("a")
        fotoLnk.href = persona.fotografia
        fotoLnk.textContent = 'Ver foto'
        fotoLnk.classList.add('btn','btn-sm', 'btn-info')
        fotoCell.appendChild(fotoLnk)

        const actionCell = row.insertCell()
        //Eliminar => botón (JS) => fetch (asíncrono)
        const btnEliminar = document.createElement("button")
        btnEliminar.textContent = 'Eliminar'
        btnEliminar.classList.add('btn', 'btn-sm', 'btn-danger')
        btnEliminar.onclick = () => eliminarPersona(persona)

        //Editar => enlace => se realizará en otra vista
        const editLnk = document.createElement("a")
        editLnk.href = `#`
        editLnk.textContent = 'Editar'
        editLnk.classList.add('btn', 'btn-sm', 'btn-warning')

        //Agregamos el botón y a la nueva celda
        actionCell.appendChild(btnEliminar)
        actionCell.appendChild(editLnk)
      });
    }

    async function eliminarPersona(persona) {
      if (confirm(`¿Está seguro de eliminar el registro de ${persona.nombres} ${persona.apellidos}?`)){

      }
    }
    document.addEventListener("DOMContentLoaded", obtenerDatos)


  </script>
</body>
</html>